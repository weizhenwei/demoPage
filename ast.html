<!DOCTYPE html>
<html>
<head>
  <title>browser ast demo</title>
</head>
<body>

<!--
<script src="https://weizhenwei.github.io/demoPage/ast/escodegen.browser.2.0.0.js"></script>
<script src="https://weizhenwei.github.io/demoPage/ast/estraverse.browser.5.2.0.js"></script>
<script src="https://weizhenwei.github.io/demoPage/ast/esprima.browser.4.0.1.js"></script>
<script src="https://weizhenwei.github.io/demoPage/ast/acorn.browser.8.4.1.js"></script>
-->

<P>
  source code:
</p>
<div>
  <textarea id="srcArea" style="width:400px; height:300px;">
    import ('https://static01.nyt.com/newsgraphics/2021/08/25/right-rail-header/b2d5c97936aa7e89d7b351d41f2bf789cbc5f44d/build/js/freebird.js');

    var a = 1 + 1;
    console.log(a);
  </textarea>
</div>

<button id="parseCode">
  parse code
</button>

<P>paresed code:</p>

<div>
  <textarea id="dstArea" style="width:400px; height:300px;">
  </textarea>
</div>

<!--
<script
  type="text/javascript"
  src="https://accounts.google.com/gsi/client"
  id="oneTapScript"
  async="async">
</script>

<div id="svelte-zkzzsx">
  good
</div>
<script type="module">
  // import { reallyReallyLongModuleMemberName as shortName, anotherLongModuleName as short } from '/modules/my-module.js';
  // import { anotherLongModuleName } from './modules/my-module.js'
  import { start } from "https://static01.nyt.com/newsgraphics/2021/coronavirus-tracking/_app/start-c7077596.js";
  const target = document.querySelector('#svelte-zkzzsx');
  target.removeAttribute('id');
  start({
    target,
    paths: {"base":"/interactive/2021","assets":"https://static01.nyt.com/newsgraphics/2021/coronavirus-tracking"},
    session: {},
    host: location.host,
    route: false,
    spa: false,
    trailing_slash: "never",
    hydrate: {
      status: 200,
      error: null,
      nodes: [
        import("https://static01.nyt.com/newsgraphics/2021/coronavirus-tracking/_app/pages/__layout.svelte-b4982ce8.js"),
        import("https://static01.nyt.com/newsgraphics/2021/coronavirus-tracking/_app/pages/embeds/[type]-dashboard/index.html.svelte-c20d527a.js")
      ],
      page: {
        host: location.host, // TODO this is redundant
        path: "/embeds/spotlight-dashboard.html",
        query: new URLSearchParams(""),
        params: {"type":"spotlight"}
      }
    }
  });
</script>

<script>document.write('<script src="https://code.jquery.com/jquery-3.5.1.min.js"><\/script>')</script>
-->

<script type="text/javascript">

function ee(e) {
  var t = e.tracking
    , n = e.pageType
    , r = e.prompt
    , o = {
      event: "impression",
      eventData: {
          pagetype: "[".concat(n, "]")
      },
      module: {
          name: r,
          context: "one_tap_auth" === r ? "masthead" : "",
          label: "vi",
          region: "[Google]"
      }
  };
  t.trackEvent(o)
}



window.onload = function() {
  // var url = 'https://static01.nyt.com/newsgraphics/2021/08/25/right-rail-header/b2d5c97936aa7e89d7b351d41f2bf789cbc5f44d/build/js/freebird.js';
  // eval("import('" + url + "')");

  var t = document.createElement("script");
  t.type = "text/javascript",
  t.src = "https://accounts.google.com/gsi/client",
  t.id = "oneTapScript",
  t.setAttribute("async", "async"),
  t.onload = function() {
    var t, n;
    // e.oneTap = "undefined" != typeof google && (null === (t = google) || void 0 === t || null === (n = t.accounts) || void 0 === n ? void 0 : n.id) || !1,
    var oneTap = google.accounts.id;

    // e.setState({
    //   scriptLoaded: !0
    // })
    
    oneTap.initialize({
      client_id: '1005640118348-amh5tgkq641oru4fbhr3psm3gt2tcc94.apps.googleusercontent.com',
      callback: () => {},
      cancel_on_tap_outside: !1,
      prompt_parent_id: "google-one-tap-prompt"
    });
    oneTap.prompt(null);
  };
  document.getElementsByTagName("head")[0].appendChild(t);

  // var srcBtn = document.getElementById('parseCode');
  // srcBtn.addEventListener('click', function (e) {
  //     var srcCode = document.getElementById('srcArea').value;
  //     console.log("sourceJS:", srcCode);
  //     
  //     // let ast = esprima.parseScript(srcCode, {
  //             //   jsx: false,
  //             //   range: false,
  //             //   loc: false,
  //             //   tolerant: true,
  //             //   tokens: false,
  //             //   comment: false
  //     // })
  //     // console.log("esprima ast:", ast);
  //     
  //     let ast = acorn.parse(srcCode, {ecmaVersion: 2020})
  //     console.log("acorn ast:", ast);
  //     estraverse.replace(ast, {
  //       leave(node, parent) {
  //         console.log("node in traverse:", node);
  //         if(node.type === 'ImportDeclaration' || node.type === 'ImportExpression') {
  //           if (node.source && node.source.value) {
  //             node.source.value = node.source.value + "?moxtra=true";
  //           }
  //         }
  //       }
  //     });
  //     console.log("estraverse ast:", ast);

  //     let sourceOutput = escodegen.generate(ast, {
  //       format: escodegen.FORMAT_DEFAULTS,
  //     parse: acorn.parse
  //     });
  //     console.log("escodegen output:", sourceOutput);
  //     
  //     var dstCode = document.getElementById('dstArea');
  //     dstCode.value=sourceOutput;
  // });
}

</script>
</body>
</html>
