<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>test postMessage</title>
<!--
<script src="https://weizhenwei.github.io/demoPage/test.js"></script>
-->

</head>
<body>
<div>
    <input id="text" type="text" value="Runoob" />
    <button id="sendMessage" >发送消息</button>

</div>
   
<div>  
    <button id="createWindow" >创建窗口</button>
</div>

<div id="recMessage">
Hello World!
</div>

<iframe
        id="receiver"
        src="https://weizhenwei.github.io/demoPage/postMessage_receiver.html"
        width="300"
        height="360">
    <p>你的浏览器不支持 iframe。</p>
</iframe>

<script>
window.onload = function() {
    var newWindow = null;
    var windowButton = document.getElementById('createWindow');
    windowButton.addEventListener('click', function (e) {
        e.preventDefault();
        newWindow = window.open("https://weizhenwei.github.io/demoPage/postMessage_receiver.html");
    });
    
    var receiver = document.getElementById('receiver').contentWindow;
    var btn = document.getElementById('sendMessage');
    btn.addEventListener('click', function (e) {
        e.preventDefault();
        var val = document.getElementById('text').value;
        receiver.postMessage("Hello "+val+"！", "https://weizhenwei.github.io");
        
        console.log("new window handler:", newWindow);
        if (newWindow) {
            newWindow.postMessage("Hello "+val+"！", "https://weizhenwei.github.io");
        }

        top.postMessage("Hello "+val+"！", "https://weizhenwei.github.io");
    });
    
    // var jsString = "import('https://static01.nyt.com/newsgraphics/2021/08/25/right-rail-header/b2d5c97936aa7e89d7b351d41f2bf789cbc5f44d/build/js/freebird.js')";
    // eval(jsString);

    var messageEle = document.getElementById('recMessage');
    window.addEventListener('message', function (e) {  // 监听 message 事件
        console.log("receive message:", e);
        messageEle.innerHTML = "从"+ e.origin +"收到消息： " + e.data;
    });
}
</script>
</body>
</html>
